[supervisord]
nodaemon=true
loglevel=info
user=root

; ==============================
; WEB SERVICE (STARTS FIRST)
; ==============================
[program:web]
priority=10
directory=/app/estate_app
command=sh -c "uvicorn app:app --host 0.0.0.0 --port ${PORT}"
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
startsecs=1
stopwaitsecs=10

; ==============================
; CELERY WORKER (DELAYED)
; ==============================
[program:celery_worker]
priority=20
directory=/app/estate_app
environment=PYTHONPATH="/app"
command=celery -A celery_worker.celery_app.app worker --loglevel=INFO --pool=solo
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
startsecs=10
stopwaitsecs=60
startretries=3
exitcodes=0,2

; ==============================
; CELERY BEAT (DELAYED MORE)
; ==============================
[program:celery_beat]
priority=30
directory=/app/estate_app
environment=PYTHONPATH="/app"
command=celery -A celery_worker.celery_app.app beat --loglevel=INFO
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
startsecs=10
stopwaitsecs=60
startretries=3
exitcodes=0,2




